<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ±åŒ—é›ªæ—… 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* æ—¥ç³»æ¥µç°¡å­—é«” & åŸºç¤è¨­å®š */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', 'Noto Sans JP', sans-serif;
            background-color: #F0F4F8; /* é›ªåœ°å»¶ä¼¸è‰² */
            color: #334155;
            -webkit-tap-highlight-color: transparent;
        }

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Banner åœ“å¼§é®ç½©æ•ˆæœ */
        .banner-mask {
            border-radius: 0 0 40px 40px;
            box-shadow: 0 10px 30px -10px rgba(148, 163, 184, 0.5);
        }

        /* æ¨¡æ“¬ App è½‰å ´ */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        /* å¡ç‰‡ç»ç’ƒæ“¬æ…‹ */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-blue': '#E3F2FD',
                        'ice-blue': '#90CAF9',
                        'deep-blue': '#1E3A8A',
                        'warm-gray': '#64748B',
                        'accent-red': '#EF4444'
                    }
                }
            }
        }
    </script>
</head>
<body>

<div id="app" class="pb-24 min-h-screen relative">

    <header class="relative w-full h-[250px] bg-gray-200 banner-mask z-20 overflow-hidden shrink-0">
        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('Banner5.jpg');"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900/40 to-transparent"></div>
        
        <div class="absolute bottom-6 left-6 text-white drop-shadow-md">
            <h1 class="text-3xl font-bold tracking-wider">æ±åŒ—é›ªæ—…</h1>
            <p class="text-sm opacity-90 mt-1">2026.02.03 - 02.10</p>
        </div>

        <div class="absolute bottom-4 right-4 flex gap-3 z-30">
            <button @click="currentTab = 'schedule'" :class="tabClass('schedule')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md">
                <i class="fa-solid fa-map-location-dot text-lg"></i>
            </button>
            <button @click="currentTab = 'info'" :class="tabClass('info')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md">
                <i class="fa-solid fa-circle-info text-lg"></i>
            </button>
            <button @click="currentTab = 'shopping'" :class="tabClass('shopping')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md">
                <i class="fa-solid fa-basket-shopping text-lg"></i>
            </button>
            <button @click="currentTab = 'expenses'" :class="tabClass('expenses')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md">
                <i class="fa-solid fa-yen-sign text-lg"></i>
            </button>
        </div>
    </header>

    <main class="-mt-6 px-4 relative z-10">

        <div v-if="currentTab === 'schedule'" class="space-y-4 fade-in">
            
            <div class="flex overflow-x-auto gap-3 pb-2 scrollbar-hide pt-2">
                <button v-for="(day, index) in days" :key="day.date" 
                    @click="selectedDayIndex = index"
                    :class="selectedDayIndex === index ? 'bg-deep-blue text-white shadow-blue-300' : 'bg-white text-gray-400'"
                    class="flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl shadow-sm transition-all border border-gray-100">
                    <span class="text-xs font-medium uppercase tracking-wider">{{ day.weekday }}</span>
                    <span class="text-2xl font-bold font-serif">{{ day.dayNum }}</span>
                </button>
            </div>

            <div class="bg-gradient-to-r from-blue-50 to-white p-4 rounded-2xl shadow-sm border border-blue-100 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i :class="currentWeather.icon" class="text-3xl text-ice-blue"></i>
                    <div>
                        <div class="text-xs text-gray-500">Weather Forecast</div>
                        <div class="font-bold text-gray-700">{{ currentWeather.temp }}Â°C <span class="text-xs font-normal text-gray-400">(é«”æ„Ÿ {{ currentWeather.feel }}Â°C)</span></div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-400">{{ days[selectedDayIndex].location }}</div>
                </div>
            </div>

            <div class="space-y-0 relative pb-20">
                <div class="absolute left-6 top-4 bottom-0 w-0.5 bg-gray-200 z-0"></div>

                <div v-for="(item, index) in currentDayItems" :key="item.id" class="relative z-10 mb-6 group">
                    
                    <div v-if="index > 0 || (index === 0 && item.travelTime)" class="pl-12 py-2 flex items-center gap-2 text-xs text-gray-400">
                        <i :class="transportIcon(item.transportType)"></i>
                        <span>{{ item.travelTime }}</span>
                    </div>
                    <div v-else-if="index === 0 && !item.travelTime" class="pl-12 py-2 text-xs text-gray-400">
                        å¾ä½å®¿å‡ºç™¼
                    </div>

                    <div class="flex gap-4 items-start">
                        <div class="w-12 flex-shrink-0 flex flex-col items-center pt-1 bg-F0F4F8">
                            <div :class="getCategoryColor(item.category)" class="w-4 h-4 rounded-full border-4 border-[#F0F4F8] shadow-sm"></div>
                            <div class="text-[10px] font-bold text-gray-400 mt-1">{{ item.startTime }}</div>
                        </div>

                        <div @click="openMap(item.name)" class="flex-grow bg-white rounded-xl p-4 shadow-sm border border-gray-100 active:scale-95 transition-transform cursor-pointer relative overflow-hidden">
                            <div class="absolute top-0 right-0 px-2 py-1 bg-gray-50 text-[10px] text-gray-400 rounded-bl-lg">{{ item.category }}</div>
                            
                            <div v-if="item.category === 'èˆªç­'" class="flex items-center gap-3 mb-2">
                                <i class="fa-solid fa-plane-departure text-ice-blue text-xl"></i>
                                <h3 class="font-bold text-lg text-deep-blue">{{ item.name }}</h3>
                            </div>
                            <h3 v-else class="font-bold text-lg text-gray-800 mb-1">{{ item.name }}</h3>
                            
                            <div class="space-y-1 text-sm text-gray-600">
                                <div v-if="item.hours"><i class="fa-regular fa-clock w-5 text-center text-xs"></i> {{ item.hours }}</div>
                                <div v-if="item.ticket"><i class="fa-solid fa-ticket w-5 text-center text-xs text-accent-red"></i> {{ item.ticket }}</div>
                                <div v-if="item.note" class="text-xs mt-2 p-2 bg-gray-50 rounded text-gray-500 border-l-2 border-ice-blue">
                                    {{ item.note }}
                                </div>
                            </div>

                            <div class="mt-3 flex justify-end gap-2 border-t border-gray-100 pt-2" @click.stop>
                                <button @click="moveItem(index, -1)" v-if="index > 0" class="w-6 h-6 rounded bg-gray-100 text-gray-500 text-xs"><i class="fa-solid fa-arrow-up"></i></button>
                                <button @click="moveItem(index, 1)" v-if="index < currentDayItems.length - 1" class="w-6 h-6 rounded bg-gray-100 text-gray-500 text-xs"><i class="fa-solid fa-arrow-down"></i></button>
                                <button @click="editItem(item)" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold">ç·¨è¼¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button @click="openAddModal" class="fixed bottom-6 right-6 w-14 h-14 bg-deep-blue text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40 hover:scale-110 transition">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-6 pt-4 pb-20 fade-in">
            
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center"><i class="fa-solid fa-calculator mr-2 text-ice-blue"></i> åŒ¯ç‡æ›ç®—</h3>
                <div class="flex gap-2 items-center">
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">æ—¥å¹£ (JPY)</label>
                        <input type="number" v-model="calcJpy" class="w-full bg-gray-50 p-2 rounded border border-gray-200 text-lg font-bold" placeholder="Â¥">
                    </div>
                    <i class="fa-solid fa-arrow-right text-gray-300 mt-5"></i>
                    <div class="flex-1">
                        <label class="text-xs text-gray-400">å°å¹£ (TWD) <span class="text-[10px]">åŒ¯ç‡:{{rate}}</span></label>
                        <div class="w-full bg-blue-50 p-2 rounded border border-blue-100 text-lg font-bold text-deep-blue">
                            ${{ (calcJpy * rate).toFixed(0) }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center"><i class="fa-solid fa-plane mr-2 text-ice-blue"></i> èˆªç­è³‡è¨Š</h3>
                <div class="space-y-4">
                    <div v-for="flight in flights" class="border-l-2 border-deep-blue pl-3">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-0.5 rounded">{{ flight.type }}</span>
                            <span class="text-xs font-mono text-gray-400">{{ flight.code }}</span>
                        </div>
                        <div class="font-bold text-gray-700">{{ flight.route }}</div>
                        <div class="text-sm text-gray-500">{{ flight.time }}</div>
                        <div class="text-xs text-gray-400 mt-1">{{ flight.terminal }}</div>
                    </div>
                </div>
            </div>

            <a href="https://japantravel.navitime.com/zh-tw/area/jp/depArrTimeList" target="_blank" class="block bg-green-500 text-white p-4 rounded-xl shadow-md flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-train text-xl"></i>
                    <span class="font-bold">ä¹˜æ›æ¡ˆå…§ (NAVITIME)</span>
                </div>
                <i class="fa-solid fa-chevron-right"></i>
            </a>

            <div class="space-y-3">
                <h3 class="font-bold text-gray-600 pl-2">ä½å®¿è³‡è¨Š</h3>
                <div v-for="hotel in hotels" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-start">
                        <div class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-500">{{ hotel.date }}</div>
                        <a :href="'https://www.google.com/maps/search/?api=1&query='+hotel.address" target="_blank" class="text-blue-500"><i class="fa-solid fa-location-arrow"></i></a>
                    </div>
                    <div class="font-bold text-gray-800 mt-1">{{ hotel.name }}</div>
                    <div class="text-xs text-gray-500 mt-1">{{ hotel.address }}</div>
                    <div class="text-xs text-gray-400 mt-1"><i class="fa-solid fa-phone mr-1"></i> {{ hotel.phone }}</div>
                </div>
            </div>

             <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                <h3 class="font-bold text-red-600 mb-2">ç·Šæ€¥è¯çµ¡</h3>
                <div class="flex justify-around text-center">
                    <a href="tel:110" class="block p-2">
                        <div class="text-2xl">ğŸ‘®</div>
                        <div class="text-xs font-bold text-gray-600">è­¦å¯Ÿ 110</div>
                    </a>
                    <a href="tel:119" class="block p-2">
                        <div class="text-2xl">ğŸš‘</div>
                        <div class="text-xs font-bold text-gray-600">æ•‘è­· 119</div>
                    </a>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'" class="pb-20 fade-in pt-4">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" class="bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 relative group">
                    <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-white/80 rounded-full w-6 h-6 flex items-center justify-center text-red-500 shadow z-10"><i class="fa-solid fa-times"></i></button>
                    <div class="h-32 bg-gray-100 flex items-center justify-center overflow-hidden">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <i v-else class="fa-solid fa-image text-gray-300 text-3xl"></i>
                    </div>
                    <div class="p-3">
                        <div class="font-bold text-sm text-gray-700 truncate">{{ item.name }}</div>
                    </div>
                </div>
            </div>
            
            <div v-if="shoppingList.length === 0" class="text-center text-gray-400 mt-20">
                <i class="fa-solid fa-basket-shopping text-4xl mb-2 opacity-30"></i>
                <p>è³¼ç‰©æ¸…å–®æ˜¯ç©ºçš„</p>
            </div>

            <button @click="showShopModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-deep-blue text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40 hover:scale-110 transition">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'expenses'" class="pb-20 fade-in pt-4 space-y-4">
            
            <div class="bg-deep-blue text-white p-6 rounded-2xl shadow-lg relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-white/10 text-9xl"><i class="fa-solid fa-yen-sign"></i></div>
                <div class="relative z-10">
                    <div class="text-sm opacity-80">ç¸½èŠ±è²» (JPY)</div>
                    <div class="text-4xl font-bold mt-1">Â¥{{ totalExpense.toLocaleString() }}</div>
                    <div class="text-xs opacity-60 mt-2">ç´„ TWD {{ (totalExpense * rate).toFixed(0).toLocaleString() }}</div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div v-for="(exp, idx) in sortedExpenses" :key="idx" class="p-4 border-b border-gray-50 flex justify-between items-center last:border-0">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-lg">
                            <i :class="getExpenseIcon(exp.category)" class="text-gray-500"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-700 text-sm">{{ exp.name }}</div>
                            <div class="text-xs text-gray-400">{{ exp.date }} Â· {{ exp.payment }}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-gray-800">Â¥{{ parseInt(exp.amount).toLocaleString() }}</div>
                        <button @click="removeExpense(idx)" class="text-xs text-red-300 hover:text-red-500 mt-1">åˆªé™¤</button>
                    </div>
                </div>
            </div>

            <button @click="showExpenseModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-deep-blue text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40 hover:scale-110 transition">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

    </main>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="closeModal">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl animate-slide-up">
            <h3 class="text-xl font-bold mb-4">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            
            <div class="space-y-3 max-h-[60vh] overflow-y-auto">
                <select v-model="form.category" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200">
                    <option>æ™¯é»</option>
                    <option>ä½å®¿</option>
                    <option>ç¾é£Ÿ</option>
                    <option>è³¼ç‰©</option>
                    <option>èˆªç­</option>
                    <option>å…¶ä»–</option>
                </select>
                <input v-model="form.name" placeholder="åç¨± (ä¾‹: è—ç‹æ¨¹å†°)" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200">
                <div class="flex gap-2">
                    <input v-model="form.startTime" type="time" class="w-1/2 p-3 bg-gray-50 rounded-xl border border-gray-200">
                    <input v-model="form.hours" placeholder="ç‡Ÿæ¥­æ™‚é–“" class="w-1/2 p-3 bg-gray-50 rounded-xl border border-gray-200">
                </div>
                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100">
                    <label class="text-xs text-blue-600 block mb-1">è‡³æ­¤è¡Œç¨‹çš„äº¤é€šæ–¹å¼ (å‰ä¸€ç«™å‡ºç™¼)</label>
                    <div class="flex gap-2 mb-2">
                        <select v-model="form.transportType" class="p-2 text-sm rounded border border-blue-200">
                            <option value="walk">æ­¥è¡Œ</option>
                            <option value="car">é–‹è»Š</option>
                            <option value="transit">å¤§çœ¾é‹è¼¸</option>
                        </select>
                        <input v-model="form.travelTime" placeholder="ä¾‹: 15åˆ†" class="flex-1 p-2 text-sm rounded border border-blue-200">
                    </div>
                </div>

                <input v-model="form.ticket" placeholder="é–€ç¥¨è³‡è¨Š" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200">
                <textarea v-model="form.note" placeholder="å‚™è¨» / ç‰¹è‰²" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 h-20"></textarea>
            </div>

            <div class="flex gap-3 mt-6">
                <button v-if="isEditing" @click="deleteItem" class="flex-1 py-3 rounded-xl bg-red-50 text-red-500 font-bold">åˆªé™¤</button>
                <button @click="saveItem" class="flex-[2] py-3 rounded-xl bg-deep-blue text-white font-bold shadow-lg shadow-blue-200">å„²å­˜</button>
            </div>
        </div>
    </div>

    <div v-if="showShopModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="showShopModal = false">
        <div class="bg-white w-80 rounded-2xl p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-4">æ–°å¢è³¼ç‰©é …ç›®</h3>
            <input v-model="shopForm.name" placeholder="å•†å“åç¨±" class="w-full p-3 bg-gray-50 rounded-xl mb-3 border border-gray-200">
            <label class="block w-full p-3 bg-gray-50 rounded-xl text-center text-gray-500 cursor-pointer border border-dashed border-gray-300 mb-4">
                <i class="fa-solid fa-camera mb-1"></i><br>ä¸Šå‚³åœ–ç‰‡
                <input type="file" @change="handleImageUpload" class="hidden" accept="image/*">
            </label>
            <div v-if="shopForm.image" class="mb-4 h-20 w-full bg-gray-100 rounded overflow-hidden">
                <img :src="shopForm.image" class="w-full h-full object-cover">
            </div>
            <button @click="saveShopItem" class="w-full py-3 bg-deep-blue text-white rounded-xl font-bold">åŠ å…¥æ¸…å–®</button>
        </div>
    </div>

    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="showExpenseModal = false">
        <div class="bg-white w-80 rounded-2xl p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-4">è¨˜å¸³</h3>
            <select v-model="expenseForm.category" class="w-full p-3 mb-2 bg-gray-50 rounded-xl">
                <option>é£²é£Ÿ</option><option>äº¤é€š</option><option>ä½å®¿</option><option>é–€ç¥¨</option><option>è³¼ç‰©</option><option>å…¶ä»–</option>
            </select>
            <input v-model="expenseForm.name" placeholder="é …ç›®åç¨±" class="w-full p-3 mb-2 bg-gray-50 rounded-xl">
            <input v-model="expenseForm.amount" type="number" placeholder="é‡‘é¡ (JPY)" class="w-full p-3 mb-2 bg-gray-50 rounded-xl">
            <div class="flex gap-2 mb-2">
                <input v-model="expenseForm.date" type="date" class="flex-1 p-3 bg-gray-50 rounded-xl text-sm">
                <select v-model="expenseForm.payment" class="flex-1 p-3 bg-gray-50 rounded-xl text-sm">
                    <option>ç¾é‡‘</option><option>ä¿¡ç”¨å¡</option><option>Suica</option>
                </select>
            </div>
            <button @click="saveExpense" class="w-full py-3 bg-deep-blue text-white rounded-xl font-bold">å„²å­˜ç´€éŒ„</button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentTab = ref('schedule');
            const selectedDayIndex = ref(0);
            const rate = ref(0.22); // é è¨­åŒ¯ç‡
            const calcJpy = ref(1000);
            
            // Modal States
            const showModal = ref(false);
            const isEditing = ref(false);
            const editingId = ref(null);
            const showShopModal = ref(false);
            const showExpenseModal = ref(false);

            // Data Structures
            const days = [
                { date: '2026-02-03', weekday: 'Tue', dayNum: '3', location: 'æ±äº¬/å±±å½¢' },
                { date: '2026-02-04', weekday: 'Wed', dayNum: '4', location: 'è—ç‹æº«æ³‰' },
                { date: '2026-02-05', weekday: 'Thu', dayNum: '5', location: 'å±±å½¢/ä»™å°' },
                { date: '2026-02-06', weekday: 'Fri', dayNum: '6', location: 'éŠ€å±±æº«æ³‰' },
                { date: '2026-02-07', weekday: 'Sat', dayNum: '7', location: 'å¥§å…¥ç€¨' },
                { date: '2026-02-08', weekday: 'Sun', dayNum: '8', location: 'é’æ£®å±‹' },
                { date: '2026-02-09', weekday: 'Mon', dayNum: '9', location: 'é’æ£®å±‹' },
                { date: '2026-02-10', weekday: 'Tue', dayNum: '10', location: 'é’æ£®/è¿”å°' },
            ];

            // Initial Data Population
            const defaultItinerary = [
                // Day 1: 2/3
                { id: 101, date: '2026-02-03', name: 'IT216 æ¡ƒåœ’ -> ç¾½ç”°', category: 'èˆªç­', startTime: '00:10', hours: '00:10-04:00', ticket: '', note: 'ç¬¬ä¸‰èˆªå»ˆ', transportType: '', travelTime: '' },
                { id: 102, date: '2026-02-03', name: 'ç¾½ç”°æ©Ÿå ´æ› JR PASS', category: 'å…¶ä»–', startTime: '06:00', hours: '', ticket: '', note: 'ç¬¬äºŒèˆªå»ˆæ—…è¡Œæœå‹™ä¸­å¿ƒ', transportType: 'walk', travelTime: 'æ©Ÿå ´å…§' },
                { id: 103, date: '2026-02-03', name: 'ç§»å‹•è‡³æ±äº¬è»Šç«™', category: 'äº¤é€š', startTime: '07:00', hours: '', ticket: 'JR PASS', note: 'å–®è»Œé›»è»Šè‡³æ¿±æ¾ç”ºè½‰å±±æ‰‹ç·š', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 104, date: '2026-02-03', name: 'Tsubasa 129 æ–°å¹¹ç·š', category: 'äº¤é€š', startTime: '08:56', hours: '08:56-11:38', ticket: 'JR PASS', note: 'æ±äº¬ -> å±±å½¢ (Yamagata)', transportType: 'transit', travelTime: '2.5hr' },
                { id: 105, date: '2026-02-03', name: 'å±±å½¢è»Šç«™åˆé¤', category: 'ç¾é£Ÿ', startTime: '11:40', hours: '', ticket: '', note: 'ç±³æ¾¤ç‰›ä¾¿ç•¶?', transportType: 'walk', travelTime: '0åˆ†' },
                { id: 106, date: '2026-02-03', name: 'å·´å£«å¾€è—ç‹æº«æ³‰', category: 'äº¤é€š', startTime: '13:20', hours: '', ticket: '1200å††', note: 'æ±å£å·´å£«ç¸½ç«™ç¬¬ä¸€æœˆå°', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 107, date: '2026-02-03', name: 'é«˜è¦‹å±‹ ç‘ ç’ƒä¿±æ¨‚', category: 'ä½å®¿', startTime: '15:00', hours: 'Check-in', ticket: '', note: 'è—ç‹æº«æ³‰ Check-in', transportType: 'walk', travelTime: '10åˆ†' },
                
                // Day 2: 2/4
                { id: 201, date: '2026-02-04', name: 'è—ç‹æ¨¹å†° (Zao Ropeway)', category: 'æ™¯é»', startTime: '09:00', hours: '08:30-17:00', ticket: '3500å††', note: 'å±±é ‚ç·šçœ‹æ¨¹å†°', transportType: 'walk', travelTime: '15åˆ†' },
                { id: 202, date: '2026-02-04', name: 'è—ç‹æº«æ³‰è¡—æ•£ç­–', category: 'æ™¯é»', startTime: '14:00', hours: '', ticket: '', note: 'å…¬å…±æµ´å ´/æº«æ³‰è¡—', transportType: 'walk', travelTime: '5åˆ†' },

                // Day 3: 2/5
                { id: 301, date: '2026-02-05', name: 'è¿”å›å±±å½¢è»Šç«™', category: 'äº¤é€š', startTime: '10:00', hours: '', ticket: '', note: 'å·´å£«', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 302, date: '2026-02-05', name: 'å‰å¾€ä»™å°', category: 'äº¤é€š', startTime: '11:30', hours: '', ticket: '', note: 'JRä»™å±±ç·š/å·´å£«', transportType: 'transit', travelTime: '1hr' },
                { id: 303, date: '2026-02-05', name: 'ä»™å°å¸‚å€é€›è¡—', category: 'è³¼ç‰©', startTime: '14:00', hours: '', ticket: '', note: 'å•†åº—è¡—/ç‰›èˆŒ', transportType: 'walk', travelTime: '5åˆ†' },
                { id: 304, date: '2026-02-05', name: 'å¯„é€è¡Œæ', category: 'å…¶ä»–', startTime: '18:00', hours: '', ticket: '', note: 'å¯„åˆ°æ˜Ÿé‡å¥§å…¥ç€¨', transportType: 'walk', travelTime: '' },
                { id: 305, date: '2026-02-05', name: 'Richmond Hotel Premier', category: 'ä½å®¿', startTime: '19:00', hours: '', ticket: '', note: 'ä»™å°ç«™å‰', transportType: 'walk', travelTime: '5åˆ†' },

                // Day 4: 2/6
                { id: 401, date: '2026-02-06', name: 'ä»™å° -> å±±å½¢ -> å¤§çŸ³ç”°', category: 'äº¤é€š', startTime: '10:00', hours: '', ticket: '', note: 'è½‰ä¹˜å¾€éŠ€å±±', transportType: 'transit', travelTime: '1.5hr' },
                { id: 402, date: '2026-02-06', name: 'å¤§çŸ³ç”° -> éŠ€å±±æº«æ³‰', category: 'äº¤é€š', startTime: '13:00', hours: '', ticket: '', note: 'æ¥é§å·´å£«', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 403, date: '2026-02-06', name: 'å¾¡å®¿ ã‚„ãªã å±‹', category: 'ä½å®¿', startTime: '15:00', hours: '', ticket: '', note: 'Check-in', transportType: 'walk', travelTime: '5åˆ†' },
                { id: 404, date: '2026-02-06', name: 'éŠ€å±±æº«æ³‰è¡—å¤œæ‹', category: 'æ™¯é»', startTime: '17:30', hours: '', ticket: '', note: 'ç¥éš±å°‘å¥³å ´æ™¯', transportType: 'walk', travelTime: '0åˆ†' },

                // Day 5: 2/7
                { id: 501, date: '2026-02-07', name: 'éŠ€å±± -> å¤§çŸ³ç”°', category: 'äº¤é€š', startTime: '08:25', hours: '08:25-09:01', ticket: '', note: 'æ¥é§è»Š', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 502, date: '2026-02-07', name: 'Tsubasa 136 å¾€å±±å½¢', category: 'äº¤é€š', startTime: '09:31', hours: '09:31-10:02', ticket: '', note: '', transportType: 'transit', travelTime: '30åˆ†' },
                { id: 503, date: '2026-02-07', name: 'å±±å½¢ -> ä»™å° -> å…«æˆ¶', category: 'äº¤é€š', startTime: '11:00', hours: '', ticket: '', note: 'ä»™å±±ç·šå¿«é€Ÿ + Hayabusa 15', transportType: 'transit', travelTime: '2hr' },
                { id: 504, date: '2026-02-07', name: 'å…«æˆ¶è»Šç«™æ¥é§', category: 'äº¤é€š', startTime: '13:50', hours: '', ticket: '', note: 'å¾€å¥§å…¥ç€¨', transportType: 'transit', travelTime: '1.5hr' },
                { id: 505, date: '2026-02-07', name: 'æ˜Ÿé‡å¥§å…¥ç€¨æºªæµé£¯åº—', category: 'ä½å®¿', startTime: '15:30', hours: '', ticket: '', note: 'Check-in', transportType: 'transit', travelTime: '0åˆ†' },
                { id: 506, date: '2026-02-07', name: 'é’æ£®è˜‹æœå»šæˆ¿', category: 'ç¾é£Ÿ', startTime: '19:20', hours: '', ticket: '', note: 'æ™šé¤ Buffet', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 507, date: '2026-02-07', name: 'å¤œè§€å†°ç€‘', category: 'æ™¯é»', startTime: '21:15', hours: '', ticket: '', note: 'é£¯åº—æ´»å‹•', transportType: 'transit', travelTime: 'å°ˆè»Š' },

                // Day 6: 2/8
                { id: 601, date: '2026-02-08', name: 'è˜‹æœå»šæˆ¿æ—©é¤', category: 'ç¾é£Ÿ', startTime: '08:30', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 602, date: '2026-02-08', name: 'å¥§å…¥ç€¨æºªæµ Bus Tour', category: 'æ™¯é»', startTime: '13:25', hours: '', ticket: '', note: '', transportType: 'transit', travelTime: '' },
                { id: 603, date: '2026-02-08', name: 'æ¥é§è‡³æ˜Ÿé‡é’æ£®å±‹', category: 'äº¤é€š', startTime: '15:30', hours: '', ticket: '', note: 'è·¨é£¯åº—æ¥é§', transportType: 'transit', travelTime: '1hr' },
                { id: 604, date: '2026-02-08', name: 'Noresore æ™šé¤', category: 'ç¾é£Ÿ', startTime: '18:15', hours: '', ticket: '', note: 'é’æ£®å±‹è‡ªåŠ©é¤', transportType: 'walk', travelTime: 'é¤¨å…§' },
                
                // Day 7: 2/9
                { id: 701, date: '2026-02-09', name: 'Noresore æ—©é¤', category: 'ç¾é£Ÿ', startTime: '08:15', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 702, date: '2026-02-09', name: 'é’æ£®å±‹è¨­æ–½é«”é©—', category: 'æ™¯é»', startTime: '10:00', hours: '', ticket: '', note: 'æ³¡æ¹¯ã€æš–çˆé¦¬è»Š', transportType: 'walk', travelTime: '' },
                { id: 703, date: '2026-02-09', name: 'Noresore æ™šé¤', category: 'ç¾é£Ÿ', startTime: '18:15', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: '' },

                // Day 8: 2/10
                { id: 801, date: '2026-02-10', name: 'Noresore æ—©é¤', category: 'ç¾é£Ÿ', startTime: '07:15', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 802, date: '2026-02-10', name: 'æ¥é§è‡³ä¸‰æ²¢é§…', category: 'äº¤é€š', startTime: '09:00', hours: '', ticket: '', note: '', transportType: 'transit', travelTime: '20åˆ†' },
                { id: 803, date: '2026-02-10', name: 'ä¸‰æ²¢ -> é’æ£®', category: 'äº¤é€š', startTime: '09:20', hours: '09:20-10:34', ticket: '', note: 'é’ä¹‹æ£®éµé“', transportType: 'transit', travelTime: '1.2hr' },
                { id: 804, date: '2026-02-10', name: 'é’æ£® -> é’æ£®æ©Ÿå ´', category: 'äº¤é€š', startTime: '12:30', hours: '12:30-13:05', ticket: '', note: 'JRå·´å£«æ±åŒ—', transportType: 'transit', travelTime: '35åˆ†' },
                { id: 805, date: '2026-02-10', name: 'BR121 é’æ£® -> æ¡ƒåœ’', category: 'èˆªç­', startTime: '15:30', hours: '15:30-19:00', ticket: '', note: 'ç¬¬ä¸€èˆªå»ˆ', transportType: 'walk', travelTime: '' }
            ];

            const flights = [
                { type: 'å»ç¨‹', code: 'IT216', route: 'TPE - HND', time: '02/03 00:10 - 04:00', terminal: 'TPE T1 / HND T3' },
                { type: 'å›ç¨‹', code: 'BR121', route: 'AOJ - TPE', time: '02/10 15:30 - 19:00', terminal: 'AOJ / TPE T2' },
            ];

            const hotels = [
                { name: 'é«˜è¦‹å±‹ ç‘ ç’ƒä¿±æ¨‚', phone: '023-610-9602', address: 'å±±å½¢ç¸£å±±å½¢å¸‚è—ç‹æº«æ³‰ä¸‰åº¦å·1118-7', date: '2/3-2/4' },
                { name: 'Richmond Hotel Premier', phone: '+81 22-716-2855', address: 'ä»™å°å¸‚é’è‘‰åŒºä¸­å¤®2-1-1', date: '2/5' },
                { name: 'å¾¡å®¿ ã‚„ãªã å±‹', phone: '0237-28-2030', address: 'å±±å½¢çœŒå°¾èŠ±æ²¢å¸‚å¤§å­—éŠ€å±±æ–°ç•‘416', date: '2/6' },
                { name: 'æ˜Ÿé‡å¥§å…¥ç€¨æºªæµé£¯åº—', phone: '+81 50-3134-8094', address: 'é’æ£®ç¸£åå’Œç”°å¸‚å¥¥ç€¬æ ƒä¹…ä¿231', date: '2/7' },
                { name: 'æ˜Ÿé‡é’æ£®å±‹', phone: '+81 50-3134-8094', address: 'é’æ£®ç¸£ä¸‰æ¾¤å¸‚å¤é–“æœ¨å±±56', date: '2/8-2/9' },
            ];

            // Reactive State
            const itineraryItems = ref(JSON.parse(localStorage.getItem('trip_itinerary')) || defaultItinerary);
            const shoppingList = ref(JSON.parse(localStorage.getItem('trip_shopping')) || []);
            const expenses = ref(JSON.parse(localStorage.getItem('trip_expenses')) || []);

            // Forms
            const form = ref({});
            const shopForm = ref({ name: '', image: null });
            const expenseForm = ref({ category: 'é£²é£Ÿ', name: '', amount: '', date: '', payment: 'ç¾é‡‘' });

            // Watchers for persistence
            watch(itineraryItems, (newVal) => localStorage.setItem('trip_itinerary', JSON.stringify(newVal)), { deep: true });
            watch(shoppingList, (newVal) => localStorage.setItem('trip_shopping', JSON.stringify(newVal)), { deep: true });
            watch(expenses, (newVal) => localStorage.setItem('trip_expenses', JSON.stringify(newVal)), { deep: true });

            // Computed
            const currentDayItems = computed(() => {
                const date = days[selectedDayIndex.value].date;
                return itineraryItems.value.filter(i => i.date === date).sort((a, b) => a.startTime.localeCompare(b.startTime)); // ç°¡å–®æ™‚é–“æ’åºï¼Œå¯æ”¹ç”¨è‡ªè¨‚indexæ’åº
            });

            // Mock Weather Logic (Hardcoded simulation based on date)
            const currentWeather = computed(() => {
                const map = [
                    { icon: 'fa-solid fa-cloud-showers-heavy', temp: -1, feel: -4 },
                    { icon: 'fa-regular fa-snowflake', temp: -5, feel: -9 }, // Zao
                    { icon: 'fa-solid fa-cloud', temp: 2, feel: 0 }, // Sendai
                    { icon: 'fa-regular fa-snowflake', temp: -3, feel: -6 }, // Ginzan
                    { icon: 'fa-regular fa-snowflake', temp: -4, feel: -8 },
                    { icon: 'fa-regular fa-snowflake', temp: -2, feel: -5 },
                    { icon: 'fa-regular fa-snowflake', temp: -2, feel: -5 },
                    { icon: 'fa-solid fa-sun', temp: 1, feel: -2 },
                ];
                return map[selectedDayIndex.value] || map[0];
            });

            const totalExpense = computed(() => {
                return expenses.value.reduce((sum, item) => sum + Number(item.amount), 0);
            });

            const sortedExpenses = computed(() => {
                return [...expenses.value].reverse();
            });

            // Methods
            const tabClass = (tab) => {
                return currentTab.value === tab ? 'bg-white/90 text-deep-blue border-2 border-white' : 'bg-white/40 text-white border border-white/30';
            };

            const getCategoryColor = (cat) => {
                const map = { 'æ™¯é»': 'bg-green-400', 'ä½å®¿': 'bg-purple-400', 'ç¾é£Ÿ': 'bg-orange-400', 'è³¼ç‰©': 'bg-pink-400', 'äº¤é€š': 'bg-blue-400', 'èˆªç­': 'bg-blue-600', 'å…¶ä»–': 'bg-gray-400' };
                return map[cat] || 'bg-gray-400';
            };

            const transportIcon = (type) => {
                if(type === 'walk') return 'fa-solid fa-person-walking';
                if(type === 'car') return 'fa-solid fa-car';
                return 'fa-solid fa-train-subway';
            };

            const getExpenseIcon = (cat) => {
                const map = { 'é£²é£Ÿ': 'fa-utensils', 'äº¤é€š': 'fa-train', 'ä½å®¿': 'fa-bed', 'é–€ç¥¨': 'fa-ticket', 'è³¼ç‰©': 'fa-bag-shopping', 'å…¶ä»–': 'fa-circle-question' };
                return `fa-solid ${map[cat]}`;
            }

            const openMap = (keyword) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(keyword)}`, '_blank');
            };

            // CRUD - Itinerary
            const openAddModal = () => {
                isEditing.value = false;
                const curDate = days[selectedDayIndex.value].date;
                form.value = { date: curDate, category: 'æ™¯é»', name: '', startTime: '', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: '15åˆ†' };
                showModal.value = true;
            };

            const editItem = (item) => {
                isEditing.value = true;
                editingId.value = item.id;
                form.value = JSON.parse(JSON.stringify(item));
                showModal.value = true;
            };

            const saveItem = () => {
                if (isEditing.value) {
                    const idx = itineraryItems.value.findIndex(i => i.id === editingId.value);
                    if(idx !== -1) itineraryItems.value[idx] = { ...form.value, id: editingId.value };
                } else {
                    itineraryItems.value.push({ ...form.value, id: Date.now() });
                }
                showModal.value = false;
            };

            const deleteItem = () => {
                if(confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
                    itineraryItems.value = itineraryItems.value.filter(i => i.id !== editingId.value);
                    showModal.value = false;
                }
            };

            const closeModal = () => showModal.value = false;

            // Sorting (Swap in array)
            const moveItem = (index, direction) => {
                // Because currentDayItems is computed, we need to find real indices in the main array
                const items = currentDayItems.value;
                const itemA = items[index];
                const itemB = items[index + direction];
                
                // Swap startTimes to reorder logically
                const tempTime = itemA.startTime;
                itemA.startTime = itemB.startTime;
                itemB.startTime = tempTime;
                
                // Force update (Since we modified properties inside the reactive array, Vue should pick it up, but let's be safe)
                // For a robust sort, usually we use an 'order' field, but swapping time works for this visual list.
            };

            // CRUD - Shopping
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => shopForm.value.image = e.target.result;
                    reader.readAsDataURL(file);
                }
            };

            const saveShopItem = () => {
                if(!shopForm.value.name) return;
                shoppingList.value.push({ ...shopForm.value });
                shopForm.value = { name: '', image: null };
                showShopModal.value = false;
            };

            const removeShoppingItem = (idx) => {
                if(confirm('åˆªé™¤å•†å“ï¼Ÿ')) shoppingList.value.splice(idx, 1);
            };

            // CRUD - Expenses
            const saveExpense = () => {
                if(!expenseForm.value.amount) return;
                expenses.value.push({ ...expenseForm.value, date: expenseForm.value.date || new Date().toISOString().split('T')[0] });
                showExpenseModal.value = false;
                expenseForm.value = { category: 'é£²é£Ÿ', name: '', amount: '', date: '', payment: 'ç¾é‡‘' }; // reset
            };

            const removeExpense = (idx) => {
                 if(confirm('åˆªé™¤ç´€éŒ„ï¼Ÿ')) expenses.value.splice(idx, 1);
            };

            onMounted(() => {
                // Auto set expense date to today
                expenseForm.value.date = new Date().toISOString().split('T')[0];
            });

            return {
                currentTab, days, selectedDayIndex, currentWeather,
                currentDayItems, flights, hotels, shoppingList, expenses, totalExpense, sortedExpenses,
                rate, calcJpy,
                showModal, isEditing, form, showShopModal, shopForm, showExpenseModal, expenseForm,
                tabClass, getCategoryColor, transportIcon, getExpenseIcon,
                openMap, openAddModal, editItem, saveItem, deleteItem, closeModal, moveItem,
                handleImageUpload, saveShopItem, removeShoppingItem, saveExpense, removeExpense
            };
        }
    }).mount('#app');
</script>
</body>
</html>