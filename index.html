<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ±åŒ—é›ªæ—… 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: #F0F4F8; 
            color: #475569;
            -webkit-tap-highlight-color: transparent;
            letter-spacing: 0.05em;
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .banner-mask {
            border-radius: 0 0 40px 40px;
            box-shadow: 0 10px 30px -10px rgba(148, 163, 184, 0.5);
        }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        @keyframes bounce-sm {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        .animate-bounce-sm { animation: bounce-sm 2s infinite; }
    </style>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { 'snow-blue': '#E3F2FD', 'ice-blue': '#90CAF9', 'deep-blue': '#3B82F6', 'warm-gray': '#64748B', 'accent-red': '#F472B6' } } }
        }
    </script>
</head>
<body>

<div id="app" class="pb-24 min-h-screen relative">

    <header class="relative w-full h-[250px] bg-gray-200 banner-mask z-20 overflow-hidden shrink-0">
        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('Banner5.jpg');"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-transparent to-black/10"></div>
        
        <div class="absolute top-8 right-6 text-white drop-shadow-md text-right">
            <h1 class="text-3xl font-bold tracking-wider">æ±åŒ—é›ªæ—…</h1>
            <p class="text-sm opacity-90 mt-1 font-medium bg-black/20 inline-block px-3 py-1 rounded-full backdrop-blur-sm">2026.02.03 - 02.10</p>
        </div>

        <div class="absolute bottom-4 right-4 flex gap-3 z-30">
            <button @click="currentTab = 'schedule'" :class="tabClass('schedule')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-110 backdrop-blur-md"><i class="fa-solid fa-map-location-dot text-lg"></i></button>
            <button @click="currentTab = 'info'" :class="tabClass('info')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md"><i class="fa-solid fa-circle-info text-lg"></i></button>
            <button @click="currentTab = 'shopping'" :class="tabClass('shopping')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md"><i class="fa-solid fa-basket-shopping text-lg"></i></button>
            <button @click="currentTab = 'expenses'" :class="tabClass('expenses')" class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 backdrop-blur-md"><i class="fa-solid fa-yen-sign text-lg"></i></button>
        </div>
    </header>

    <main class="-mt-6 px-4 relative z-10">

        <div v-if="currentTab === 'schedule'" class="space-y-4 fade-in">
            
            <div class="flex overflow-x-auto gap-3 pb-2 scrollbar-hide pt-2">
                <button v-for="(day, index) in days" :key="day.date" @click="selectedDayIndex = index" :class="selectedDayIndex === index ? 'bg-deep-blue text-white shadow-blue-200' : 'bg-white text-gray-400'" class="flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl shadow-sm transition-all border border-gray-100">
                    <span class="text-xs font-bold">{{ day.weekday }}</span><span class="text-2xl font-bold mt-1">{{ day.dayNum }}</span>
                </button>
            </div>

            <div class="bg-gradient-to-r from-blue-50 to-white p-4 rounded-3xl shadow-sm border border-blue-100 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i :class="currentWeather.icon" class="text-3xl text-ice-blue animate-bounce-sm"></i>
                    <div><div class="text-xs text-gray-400 font-bold">Weather</div><div class="font-bold text-gray-700 text-lg">{{ currentWeather.temp }}Â°C <span class="text-xs font-medium text-gray-400">(é«”æ„Ÿ {{ currentWeather.feel }}Â°C)</span></div></div>
                </div>
                <div class="text-right"><div class="text-xs text-blue-400 font-bold px-3 py-1 bg-white rounded-full shadow-sm">{{ days[selectedDayIndex].location }}</div></div>
            </div>

            <div class="space-y-0 relative">
                <div class="absolute left-6 top-4 bottom-0 w-0.5 bg-gray-200 z-0 rounded-full"></div>

                <div v-for="(item, index) in currentDayItems" :key="item.id" class="relative z-10 mb-6 group">
                    <div v-if="index > 0 || (index === 0 && item.travelTime)" class="pl-12 py-2 flex items-center gap-2 text-xs text-gray-400 font-medium">
                        <i :class="transportIcon(item.transportType)"></i><span>{{ item.travelTime }}</span>
                    </div>
                    <div v-else-if="index === 0 && !item.travelTime" class="pl-12 py-2 text-xs text-gray-400 font-medium">å¾ä½å®¿å‡ºç™¼</div>

                    <div class="flex gap-4 items-start">
                        <div class="w-12 flex-shrink-0 flex flex-col items-center pt-1 bg-F0F4F8">
                            <div :class="getCategoryColor(item.category)" class="w-4 h-4 rounded-full border-4 border-[#F0F4F8] shadow-sm"></div>
                            <div class="text-[10px] font-bold text-gray-400 mt-1">{{ item.startTime }}</div>
                        </div>

                        <div @click="openMap(item.name)" class="flex-grow bg-white rounded-2xl p-4 shadow-sm border border-gray-100 active:scale-95 transition-transform cursor-pointer relative overflow-hidden">
                            <div class="absolute top-0 right-0 px-3 py-1.5 bg-gray-50 text-[10px] font-bold text-gray-400 rounded-bl-2xl">{{ item.category }}</div>
                            
                            <div v-if="item.category === 'èˆªç­'" class="flex items-center gap-3 mb-2">
                                <i class="fa-solid fa-plane-departure text-ice-blue text-xl"></i><h3 class="font-bold text-lg text-deep-blue">{{ item.name }}</h3>
                            </div>
                            <h3 v-else class="font-bold text-lg text-gray-700 mb-1 flex flex-wrap items-center gap-2">
                                {{ item.name }}
                                <button v-if="item.timetableId" @click.stop="openBusModal(item.timetableId)" class="text-xs bg-deep-blue text-white px-3 py-1 rounded-full flex items-center gap-1 hover:bg-blue-600 shadow-md transition-transform active:scale-95">
                                    <i class="fa-solid fa-clock"></i> {{ item.timetableLabel || 'æ™‚åˆ»è¡¨' }}
                                </button>
                                <button v-if="item.timetableId2" @click.stop="openBusModal(item.timetableId2)" class="text-xs bg-green-500 text-white px-3 py-1 rounded-full flex items-center gap-1 hover:bg-green-600 shadow-md transition-transform active:scale-95">
                                    <i class="fa-solid fa-clock"></i> {{ item.timetableLabel2 }}
                                </button>
                            </h3>
                            
                            <div class="space-y-1 text-sm text-gray-500 font-medium">
                                <div v-if="item.hours"><i class="fa-regular fa-clock w-5 text-center text-xs opacity-70"></i> {{ item.hours }}</div>
                                <div v-if="item.ticket"><i class="fa-solid fa-ticket w-5 text-center text-xs text-accent-red opacity-70"></i> {{ item.ticket }}</div>
                                <div v-if="item.note" class="text-xs mt-2 p-2 bg-blue-50/50 rounded-xl text-gray-500 border-l-4 border-ice-blue">{{ item.note }}</div>
                            </div>

                            <div class="mt-3 flex justify-end gap-2 border-t border-gray-50 pt-2" @click.stop>
                                <button @click="moveItem(index, -1)" v-if="index > 0" class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 text-xs"><i class="fa-solid fa-arrow-up"></i></button>
                                <button @click="moveItem(index, 1)" v-if="index < currentDayItems.length - 1" class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 text-xs"><i class="fa-solid fa-arrow-down"></i></button>
                                <button @click="editItem(item)" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold">ç·¨è¼¯</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative z-10 pl-12 pb-20">
                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-2xl p-4 border border-gray-100 shadow-sm relative overflow-hidden">
                        <i class="fa-solid fa-quote-left absolute top-2 left-2 text-gray-100 text-4xl -z-0"></i>
                        <h4 class="font-bold text-gray-700 text-sm mb-1 relative z-10 flex items-center gap-2"><i class="fa-solid fa-map-pin text-accent-red"></i> é—œæ–¼{{ days[selectedDayIndex].location }}</h4>
                        <p class="text-xs text-gray-500 leading-relaxed relative z-10 text-justify">{{ days[selectedDayIndex].intro }}</p>
                    </div>
                </div>
            </div>
            
            <button @click="openAddModal" class="fixed bottom-6 right-6 w-14 h-14 bg-deep-blue text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40 hover:scale-110 transition active:scale-95"><i class="fa-solid fa-plus"></i></button>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-6 pt-4 pb-20 fade-in">
            
            <div class="bg-red-50 p-5 rounded-3xl border border-red-100 shadow-sm">
                <h3 class="font-bold text-red-500 mb-3 flex items-center"><i class="fa-solid fa-triangle-exclamation mr-2"></i> ç·Šæ€¥è¯çµ¡ (æ—¥æœ¬)</h3>
                <div class="flex justify-around text-center gap-4">
                    <a href="tel:110" class="block flex-1 bg-white p-3 rounded-2xl shadow-sm active:scale-95 transition">
                        <div class="text-3xl mb-1">ğŸ‘®</div><div class="text-sm font-bold text-gray-700">è­¦å¯Ÿ 110</div>
                    </a>
                    <a href="tel:119" class="block flex-1 bg-white p-3 rounded-2xl shadow-sm active:scale-95 transition">
                        <div class="text-3xl mb-1">ğŸš‘</div><div class="text-sm font-bold text-gray-700">æ•‘è­·/ç«è­¦ 119</div>
                    </a>
                </div>
            </div>

            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fa-solid fa-calculator mr-2 text-ice-blue"></i> åŒ¯ç‡å°å¹«æ‰‹</h3>
                <div class="flex gap-2 items-center">
                    <div class="flex-1"><label class="text-xs text-gray-400 font-bold ml-1">æ—¥å¹£ (JPY)</label><input type="number" v-model="calcJpy" class="w-full bg-gray-50 p-3 rounded-2xl border-none text-lg font-bold text-gray-700" placeholder="Â¥"></div>
                    <i class="fa-solid fa-arrow-right text-gray-300 mt-5"></i>
                    <div class="flex-1"><label class="text-xs text-gray-400 font-bold ml-1">å°å¹£ (TWD)</label><div class="w-full bg-blue-50 p-3 rounded-2xl border border-blue-100 text-lg font-bold text-deep-blue">${{ (calcJpy * rate).toFixed(0) }}</div></div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fa-solid fa-plane mr-2 text-ice-blue"></i> èˆªç­è³‡è¨Š</h3>
                <div class="space-y-4">
                    <div v-for="flight in flights" class="border-l-4 border-ice-blue pl-4 py-1">
                        <div class="flex justify-between items-center mb-1"><span class="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">{{ flight.type }}</span><span class="text-xs font-bold text-gray-400 tracking-wider">{{ flight.code }}</span></div>
                        <div class="font-bold text-gray-700 text-lg">{{ flight.route }}</div><div class="text-sm text-gray-500 font-medium">{{ flight.time }}</div><div class="text-xs text-gray-400 mt-1 font-medium">{{ flight.terminal }}</div>
                    </div>
                </div>
            </div>

            <a href="https://www.navitime.co.jp/zh-tw/transfer/" target="_blank" class="block bg-green-500 text-white p-4 rounded-2xl shadow-md flex items-center justify-between active:scale-95 transition">
                <div class="flex items-center gap-3"><i class="fa-solid fa-train text-xl"></i><span class="font-bold tracking-wide">ä¹˜æ›æ¡ˆå…§ (NAVITIME)</span></div><i class="fa-solid fa-chevron-right opacity-50"></i>
            </a>

            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fa-solid fa-language mr-2 text-ice-blue"></i> æ—¥æœ¬åœ°åå°ç…§</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div v-for="place in locationGlossary" class="bg-gray-50 p-2 rounded-xl flex flex-col items-center justify-center text-center"><div class="font-bold text-gray-700">{{ place.name }}</div><div class="text-xs text-gray-400 font-mono mt-0.5">{{ place.romaji }}</div></div>
                </div>
            </div>

            <div class="space-y-3">
                <h3 class="font-bold text-gray-500 pl-2 text-sm">ä½å®¿è³‡è¨Š</h3>
                <div v-for="hotel in hotels" class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-start"><div class="text-xs bg-gray-100 px-2 py-1 rounded-lg text-gray-500 font-bold">{{ hotel.date }}</div><a :href="'https://www.google.com/maps/search/?api=1&query='+hotel.address" target="_blank" class="text-deep-blue bg-blue-50 w-8 h-8 flex items-center justify-center rounded-full"><i class="fa-solid fa-location-arrow"></i></a></div>
                    <div class="font-bold text-gray-800 mt-2 text-lg">{{ hotel.name }}</div><div class="text-xs text-gray-500 mt-1 font-medium">{{ hotel.address }}</div><div class="text-xs text-gray-400 mt-2 font-medium flex items-center"><i class="fa-solid fa-phone mr-2 text-ice-blue"></i> {{ hotel.phone }}</div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-3xl shadow-sm border border-yellow-200 bg-yellow-50/30">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fa-solid fa-file-shield mr-2 text-yellow-500"></i> æ—…éŠä¿éšªè³‡è¨Š</h3>
                <textarea v-model="insuranceInfo" placeholder="è«‹åœ¨æ­¤è¼¸å…¥ä¿éšªå…¬å¸ã€ä¿å–®è™Ÿç¢¼ã€æµ·å¤–ç·Šæ€¥æ•‘æ´é›»è©±..." class="w-full p-3 bg-white rounded-xl border border-gray-200 text-sm text-gray-600 h-24 focus:ring-2 focus:ring-yellow-200 focus:border-yellow-400 outline-none"></textarea>
                <p class="text-[10px] text-gray-400 mt-2 text-right">*ç³»çµ±æœƒè‡ªå‹•å„²å­˜æ‚¨è¼¸å…¥çš„å…§å®¹</p>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'" class="pb-20 fade-in pt-4">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" class="bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 relative group">
                    <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-white/90 rounded-full w-7 h-7 flex items-center justify-center text-red-400 shadow z-10 hover:text-red-600"><i class="fa-solid fa-times"></i></button>
                    <div class="h-36 bg-gray-50 flex items-center justify-center overflow-hidden"><img v-if="item.image" :src="item.image" class="w-full h-full object-cover"><i v-else class="fa-solid fa-image text-gray-200 text-3xl"></i></div>
                    <div class="p-3"><div class="font-bold text-sm text-gray-700 truncate">{{ item.name }}</div></div>
                </div>
            </div>
            <div v-if="shoppingList.length === 0" class="text-center text-gray-300 mt-20"><i class="fa-solid fa-basket-shopping text-5xl mb-3 opacity-30"></i><p class="font-bold">è³¼ç‰©æ¸…å–®æ˜¯ç©ºçš„</p><p class="text-xs mt-1">æŒ‰å³ä¸‹è§’ + é–‹å§‹æ–°å¢</p></div>
            <button @click="showShopModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-deep-blue text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40 hover:scale-110 transition active:scale-95"><i class="fa-solid fa-plus"></i></button>
        </div>

        <div v-if="currentTab === 'expenses'" class="pb-20 fade-in pt-4 space-y-4">
            <div class="bg-deep-blue text-white p-6 rounded-3xl shadow-lg shadow-blue-200 relative overflow-hidden">
                <div class="absolute -right-6 -top-6 text-white/10 text-[10rem] rotate-12"><i class="fa-solid fa-yen-sign"></i></div>
                <div class="relative z-10"><div class="text-sm opacity-80 font-bold tracking-wide">ç¸½èŠ±è²» (JPY)</div><div class="text-4xl font-bold mt-1 tracking-tight">Â¥{{ totalExpense.toLocaleString() }}</div><div class="text-xs opacity-60 mt-2 font-medium bg-white/20 inline-block px-2 py-1 rounded-lg">ç´„ TWD {{ (totalExpense * rate).toFixed(0).toLocaleString() }}</div></div>
            </div>
            <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden px-2">
                <div v-for="(exp, idx) in sortedExpenses" :key="idx" class="p-4 border-b border-gray-50 flex justify-between items-center last:border-0">
                    <div class="flex items-center gap-4"><div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-lg text-blue-400"><i :class="getExpenseIcon(exp.category)"></i></div><div><div class="font-bold text-gray-700 text-sm">{{ exp.name }}</div><div class="text-xs text-gray-400 font-medium mt-0.5">{{ exp.date }} Â· {{ exp.payment }}</div></div></div>
                    <div class="text-right"><div class="font-bold text-gray-800">Â¥{{ parseInt(exp.amount).toLocaleString() }}</div><button @click="removeExpense(idx)" class="text-xs text-red-300 hover:text-red-500 mt-1 font-bold">åˆªé™¤</button></div>
                </div>
            </div>
            <button @click="showExpenseModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-deep-blue text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40 hover:scale-110 transition active:scale-95"><i class="fa-solid fa-plus"></i></button>
        </div>

    </main>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm" @click.self="closeModal">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
            <h3 class="text-xl font-bold mb-4 text-gray-800">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            <div class="space-y-3 max-h-[60vh] overflow-y-auto pr-1">
                <select v-model="form.category" class="w-full p-3 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"><option>æ™¯é»</option><option>ä½å®¿</option><option>ç¾é£Ÿ</option><option>è³¼ç‰©</option><option>èˆªç­</option><option>å…¶ä»–</option></select>
                <input v-model="form.name" placeholder="åç¨±" class="w-full p-3 bg-gray-50 rounded-2xl border-none font-bold text-gray-700">
                <div class="flex gap-3"><input v-model="form.startTime" type="time" class="w-1/2 p-3 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"><input v-model="form.hours" placeholder="ç‡Ÿæ¥­æ™‚é–“" class="w-1/2 p-3 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"></div>
                <div class="text-xs text-gray-400 ml-1">é€²éšï¼šæ™‚åˆ»è¡¨ä»£ç¢¼ (å¦‚ zao_bus)</div><input v-model="form.timetableId" placeholder="ç„¡" class="w-full p-2 bg-gray-50 rounded-xl border-none text-xs text-gray-500">
                <div class="bg-blue-50/50 p-4 rounded-2xl border border-blue-100">
                    <label class="text-xs text-blue-500 font-bold block mb-2">äº¤é€šæ–¹å¼ (å‰ä¸€ç«™å‡ºç™¼)</label>
                    <div class="flex gap-2"><select v-model="form.transportType" class="p-2 text-sm rounded-xl border-none bg-white text-gray-600 font-bold"><option value="walk">æ­¥è¡Œ</option><option value="car">é–‹è»Š</option><option value="transit">å¤§çœ¾é‹è¼¸</option></select><input v-model="form.travelTime" placeholder="ä¾‹: 15åˆ†" class="flex-1 p-2 text-sm rounded-xl border-none bg-white font-bold text-gray-700"></div>
                </div>
                <input v-model="form.ticket" placeholder="é–€ç¥¨" class="w-full p-3 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"><textarea v-model="form.note" placeholder="å‚™è¨»" class="w-full p-3 bg-gray-50 rounded-2xl border-none font-bold text-gray-700 h-20 resize-none"></textarea>
            </div>
            <div class="flex gap-3 mt-6"><button v-if="isEditing" @click="deleteItem" class="flex-1 py-3 rounded-2xl bg-red-50 text-red-500 font-bold">åˆªé™¤</button><button @click="saveItem" class="flex-[2] py-3 rounded-2xl bg-deep-blue text-white font-bold shadow-lg shadow-blue-200">å„²å­˜</button></div>
        </div>
    </div>

    <div v-if="showBusModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm px-4" @click.self="showBusModal = false">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative">
            <button @click="showBusModal = false" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fa-solid fa-times text-xl"></i></button>
            <h3 class="text-xl font-bold mb-1 text-center text-gray-800"><i class="fa-solid fa-bus text-deep-blue mr-2"></i>å·´å£«/JR æ™‚åˆ»è¡¨</h3>
            <p class="text-center text-xs text-gray-400 mb-4">{{ currentBusRoute }}</p>
            <div class="overflow-y-auto max-h-[60vh] rounded-xl border border-gray-100">
                <table class="w-full text-sm text-center"><thead class="bg-blue-50 text-deep-blue font-bold sticky top-0"><tr><th class="py-2">å‡ºç™¼</th><th class="py-2">æŠµé”</th></tr></thead><tbody class="divide-y divide-gray-50 text-gray-600"><tr v-for="time in currentBusSchedule" class="odd:bg-white even:bg-gray-50/50"><td class="py-2 font-mono font-bold">{{ time.dep }}</td><td class="py-2 font-mono">{{ time.arr }}</td></tr></tbody></table>
            </div>
            <p class="text-[10px] text-gray-400 mt-3 text-center">*æ­¤ç‚ºé å®šè¡¨ï¼Œå¯¦éš›ä»¥ç¾å ´ç‚ºæº–</p>
        </div>
    </div>

    <div v-if="showShopModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm" @click.self="showShopModal = false"><div class="bg-white w-80 rounded-3xl p-6 shadow-2xl"><h3 class="font-bold text-lg mb-4 text-gray-800">æ–°å¢è³¼ç‰©é …ç›®</h3><input v-model="shopForm.name" placeholder="å•†å“åç¨±" class="w-full p-4 bg-gray-50 rounded-2xl mb-3 border-none font-bold text-gray-700"><label class="block w-full p-6 bg-gray-50 rounded-2xl text-center text-gray-400 cursor-pointer border-2 border-dashed border-gray-200 hover:border-blue-300 transition mb-4"><i class="fa-solid fa-camera mb-2 text-2xl"></i><br><span class="text-xs font-bold">ä¸Šå‚³åœ–ç‰‡</span><input type="file" @change="handleImageUpload" class="hidden" accept="image/*"></label><div v-if="shopForm.image" class="mb-4 h-24 w-full bg-gray-100 rounded-2xl overflow-hidden border border-gray-100"><img :src="shopForm.image" class="w-full h-full object-cover"></div><button @click="saveShopItem" class="w-full py-3 bg-deep-blue text-white rounded-2xl font-bold shadow-lg shadow-blue-200">åŠ å…¥æ¸…å–®</button></div></div>
    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm" @click.self="showExpenseModal = false"><div class="bg-white w-80 rounded-3xl p-6 shadow-2xl"><h3 class="font-bold text-lg mb-4 text-gray-800">è¨˜å¸³</h3><select v-model="expenseForm.category" class="w-full p-3 mb-2 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"><option>é£²é£Ÿ</option><option>äº¤é€š</option><option>ä½å®¿</option><option>é–€ç¥¨</option><option>è³¼ç‰©</option><option>å…¶ä»–</option></select><input v-model="expenseForm.name" placeholder="é …ç›®åç¨±" class="w-full p-3 mb-2 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"><input v-model="expenseForm.amount" type="number" placeholder="é‡‘é¡ (JPY)" class="w-full p-3 mb-2 bg-gray-50 rounded-2xl border-none font-bold text-gray-700"><div class="flex gap-2 mb-2"><input v-model="expenseForm.date" type="date" class="flex-1 p-3 bg-gray-50 rounded-2xl text-sm font-bold text-gray-600 border-none"><select v-model="expenseForm.payment" class="flex-1 p-3 bg-gray-50 rounded-2xl text-sm font-bold text-gray-600 border-none"><option>ç¾é‡‘</option><option>ä¿¡ç”¨å¡</option><option>Suica</option></select></div><button @click="saveExpense" class="w-full py-3 bg-deep-blue text-white rounded-2xl font-bold shadow-lg shadow-blue-200">å„²å­˜ç´€éŒ„</button></div></div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;
    const DATA_VERSION = '2026-v12.0'; // Updated version trigger

    createApp({
        setup() {
            const currentTab = ref('schedule');
            const selectedDayIndex = ref(0);
            const rate = ref(0.22);
            const calcJpy = ref(1000);
            const showModal = ref(false);
            const isEditing = ref(false);
            const editingId = ref(null);
            const showShopModal = ref(false);
            const showExpenseModal = ref(false);
            const showBusModal = ref(false);
            const currentBusSchedule = ref([]);
            const currentBusRoute = ref('');
            const insuranceInfo = ref(localStorage.getItem('trip_insurance') || '');

            watch(insuranceInfo, (newVal) => localStorage.setItem('trip_insurance', newVal));

            const days = [
                { date: '2026-02-03', weekday: 'Tue', dayNum: '3', location: 'æ±äº¬/å±±å½¢', intro: 'è—ç‹æº«æ³‰ï¼ˆZao Onsenï¼‰ä»¥å¼·é…¸æ€§ç¡«ç£ºæ³‰èåï¼Œå†¬å­£çš„ã€Œæ¨¹å†°ã€å¥‡æ™¯æ›´æ˜¯ä¸–ç•Œç´šæ™¯è§€ï¼Œè¢«ç¨±ç‚ºã€Œé›ªæ€ªã€ã€‚' },
                { date: '2026-02-04', weekday: 'Wed', dayNum: '4', location: 'è—ç‹æº«æ³‰', intro: 'æ­ä¹˜è—ç‹çºœè»Šå¯ä¿¯ç°å£¯è§€çš„æ¨¹å†°åŸã€‚é€™è£¡ä¹Ÿæ˜¯æ»‘é›ªå‹åœ°ï¼Œæ“æœ‰å–®æ¿é›™æ¿éƒ½é©åˆçš„å»£é—Šé›ªé“ã€‚' },
                { date: '2026-02-05', weekday: 'Thu', dayNum: '5', location: 'å±±å½¢/ä»™å°', intro: 'ä»™å°æ˜¯æ±åŒ—è³¼ç‰©å¤©å ‚ï¼å¾è»Šç«™é€£æ¥çš„ S-PALã€Parcoï¼Œåˆ°è‘—åçš„ Clis Road å•†åº—è¡—ï¼Œè—¥å¦ã€æœé£¾ã€é›œè²¨æ‡‰æœ‰ç›¡æœ‰ã€‚æ™šé¤æ¨è–¦ä»™å°å†¬å­£é™å®šçš„ã€ŒèŠ¹èœé‹ã€ã€‚' },
                { date: '2026-02-06', weekday: 'Fri', dayNum: '6', location: 'éŠ€å±±æº«æ³‰', intro: 'éŠ€å±±æº«æ³‰ï¼ˆGinzan Onsenï¼‰ä¿ç•™äº†å¤§æ­£æµªæ¼«æ™‚æœŸçš„æœ¨é€ å»ºç¯‰ï¼Œå¤œæ™šç…¤æ°£ç‡ˆäº®èµ·æ™‚ï¼Œå½·å½¿é€²å…¥ã€Šç¥éš±å°‘å¥³ã€‹çš„ä¸–ç•Œã€‚' },
                { date: '2026-02-07', weekday: 'Sat', dayNum: '7', location: 'å¥§å…¥ç€¨', intro: 'å¥§å…¥ç€¨æºªæµï¼ˆOirase Gorgeï¼‰å†¬å­£æœƒå½¢æˆå£¯è§€çš„å†°ç€‘ï¼Œæ˜Ÿé‡åº¦å‡æ‘æä¾›å°ˆå±¬çš„å†°ç€‘å¤œéŠæ´»å‹•ã€‚' },
                { date: '2026-02-08', weekday: 'Sun', dayNum: '8', location: 'é’æ£®å±‹', intro: 'æ—¥æœ¬æœ¬å·æœ€åŒ—ç«¯çš„ç¸£ï¼Œå£¯éº—çš„è‡ªç„¶é¢¨å…‰å¦‚ä¸–ç•Œéºç”¢ç™½ç¥å±±åœ°ã€åå’Œç”°æ¹–ã€å¥§å…¥ç€¨æºªæµã€ç†±é¬§çš„å‚³çµ±é’æ£®ç¡é­”ç¥­å’Œç¾å‘³çš„ç‰¹ç”¢è˜‹æœã€æµ·é®®ã€æ—¥æœ¬é…’è€Œèåï¼Œå››å­£åˆ†æ˜ï¼Œæ“æœ‰ç¨ç‰¹çš„é­…åŠ›ã€‚' },
                { date: '2026-02-09', weekday: 'Mon', dayNum: '9', location: 'é’æ£®å±‹', intro: 'æ˜Ÿé‡é’æ£®å±‹å¯ä»¥å®Œæ•´é«”é©—é’æ£®æ–‡åŒ–ï¼ŒåŒ…å«è‘—åçš„ã€Œç¡é­”ç¥­ã€ç‡ˆç± è£é£¾èˆ‡éœ²å¤©é¢¨å‘‚ã€Œæµ®æ¹¯ã€ã€‚' },
                { date: '2026-02-10', weekday: 'Tue', dayNum: '10', location: 'é’æ£®/è¿”å°', intro: 'æ—…ç¨‹çµ‚é»ï¼Œå¯ä»¥åœ¨é’æ£®å¸‚å€è³¼è²·è˜‹æœæ´¾ã€è˜‹æœæ±ç­‰ä¼´æ‰‹ç¦®ã€‚' },
            ];

            const locationGlossary = ref([
                { name: 'å±±å½¢', romaji: 'Yamagata' }, { name: 'è—ç‹', romaji: 'Zao' }, { name: 'ä»™å°', romaji: 'Sendai' },
                { name: 'éŠ€å±±æº«æ³‰', romaji: 'Ginzan Onsen' }, { name: 'å¤§çŸ³ç”°', romaji: 'Oishida' }, { name: 'å¥§å…¥ç€¨', romaji: 'Oirase' },
                { name: 'é’æ£®', romaji: 'Aomori' }, { name: 'å…«æˆ¶', romaji: 'Hachinohe' }, { name: 'ä¸‰æ¾¤', romaji: 'Misawa' },
                { name: 'ç¾½ç”°', romaji: 'Haneda' }, { name: 'æ±äº¬', romaji: 'Tokyo' }
            ]);

            const busTimetables = {
                'zao_bus': {
                    route: 'å±±å½¢é§…å‰ - è—ç‹æº«æ³‰',
                    schedule: [ { dep: '12:20', arr: '12:57' }, { dep: '13:20', arr: '13:57' }, { dep: '14:20', arr: '14:57' }, { dep: '15:20', arr: '15:57' }, { dep: '16:20', arr: '16:57' }, { dep: '17:40', arr: '18:17' } ]
                },
                'yamagata_return_bus': {
                    route: 'è—ç‹æº«æ³‰ - å±±å½¢é§…å‰',
                    schedule: [ { dep: '08:40', arr: '09:15' }, { dep: '09:40', arr: '10:15' }, { dep: '10:40', arr: '11:15' }, { dep: '11:40', arr: '12:15' }, { dep: '12:40', arr: '13:15' } ]
                },
                'sendai_jr_rapid': {
                    route: 'JR ä»™å±±ç·š (å±±å½¢ç™¼)',
                    schedule: [ { dep: '09:12', arr: '10:35' }, { dep: '10:16', arr: '11:42' }, { dep: '11:05', arr: '12:26' }, { dep: '12:00', arr: '13:21' }, { dep: '12:50', arr: '14:12' } ]
                },
                'sendai_bus_express': {
                    route: 'é«˜é€Ÿå·´å£« (å±±å½¢ç™¼)',
                    schedule: [ { dep: '08:30', arr: '09:37' }, { dep: '08:45', arr: '09:52' }, { dep: '09:00', arr: '10:07' }, { dep: '09:15', arr: '10:22' }, { dep: '09:30', arr: '10:37' }, { dep: '09:45', arr: '10:52' } ]
                },
                'misawa_aomori_train': {
                    route: 'é’ä¹‹æ£®éµé“ ä¸‰æ¾¤ - é’æ£®',
                    schedule: [ { dep: '09:20', arr: '10:34' }, { dep: '10:50', arr: '12:12' } ]
                }
            };

            const defaultItinerary = [
                // Day 1: 2/3
                { id: 101, date: '2026-02-03', name: 'IT216 æ¡ƒåœ’ - ç¾½ç”°', category: 'èˆªç­', startTime: '00:10', hours: '00:10-04:00', ticket: '', note: 'ç¬¬ä¸‰èˆªå»ˆ', transportType: '', travelTime: '' },
                { id: 102, date: '2026-02-03', name: 'ç¾½ç”°æ©Ÿå ´æ› JR PASS', category: 'å…¶ä»–', startTime: '06:00', hours: '', ticket: '', note: 'ç¬¬äºŒèˆªå»ˆæ—…è¡Œæœå‹™ä¸­å¿ƒ', transportType: 'walk', travelTime: 'æ©Ÿå ´å…§' },
                { id: 103, date: '2026-02-03', name: 'ç§»å‹•è‡³æ±äº¬è»Šç«™', category: 'äº¤é€š', startTime: '07:00', hours: '', ticket: 'JR PASS', note: 'å–®è»Œé›»è»Šè‡³æ¿±æ¾ç”ºè½‰å±±æ‰‹ç·š', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 104, date: '2026-02-03', name: 'Tsubasa 129 æ–°å¹¹ç·š', category: 'äº¤é€š', startTime: '08:56', hours: '08:56-11:38', ticket: 'JR PASS', note: 'æ±äº¬ - å±±å½¢ (Yamagata)', transportType: 'transit', travelTime: '2.5hr' },
                { id: 105, date: '2026-02-03', name: 'å±±å½¢è»Šç«™åˆé¤', category: 'ç¾é£Ÿ', startTime: '11:40', hours: '', ticket: '', note: 'ç±³æ¾¤ç‰›ä¾¿ç•¶?', transportType: 'walk', travelTime: '0åˆ†' },
                { id: 106, date: '2026-02-03', name: 'å·´å£«å¾€è—ç‹æº«æ³‰', category: 'äº¤é€š', startTime: '13:20', hours: '', ticket: '1200å††', note: 'æ±å£å·´å£«ç¸½ç«™ç¬¬ä¸€æœˆå°', transportType: 'transit', travelTime: '40åˆ†', timetableId: 'zao_bus' },
                { id: 107, date: '2026-02-03', name: 'é«˜è¦‹å±‹ ç‘ ç’ƒä¿±æ¨‚åº¦å‡å€', category: 'ä½å®¿', startTime: '15:00', hours: 'Check-in', ticket: '', note: 'è—ç‹æº«æ³‰ Check-in', transportType: 'walk', travelTime: '10åˆ†' },
                
                // Day 2: 2/4
                { id: 201, date: '2026-02-04', name: 'è—ç‹æ¨¹å†°', category: 'æ™¯é»', startTime: '09:00', hours: '08:30-17:00', ticket: '3500å††', note: 'å±±é ‚ç·šçœ‹æ¨¹å†°', transportType: 'walk', travelTime: '15åˆ†' },
                { id: 202, date: '2026-02-04', name: 'æº«æ³‰è¡—å’–å•¡ & æ•£ç­–', category: 'ç¾é£Ÿ', startTime: '13:00', hours: '', ticket: '', note: 'å±±å£é¤…å±‹ (éº»ç³¬) / éŸ³èŒ¶å±‹', transportType: 'walk', travelTime: '5åˆ†' },
                { id: 203, date: '2026-02-04', name: 'è—ç‹å¤§éœ²å¤©é¢¨å‘‚', category: 'æ™¯é»', startTime: '15:00', hours: '', ticket: '600å††', note: 'é«”é©—é›ªä¸­æº«æ³‰ (è¦–é–‹æ”¾ç‹€æ³)', transportType: 'walk', travelTime: '15åˆ†' },
                
                // Day 3: 2/5 (Shopping Focused)
                { id: 301, date: '2026-02-05', name: 'å·´å£«è¿”å›å±±å½¢è»Šç«™', category: 'äº¤é€š', startTime: '08:40', hours: '', ticket: '1200å††', note: 'è—ç‹å·´å£«ç¸½ç«™', transportType: 'walk', travelTime: '10åˆ†', timetableId: 'yamagata_return_bus' },
                { id: 302, date: '2026-02-05', name: 'ç§»å‹•ï¼šå±±å½¢ - ä»™å°', category: 'äº¤é€š', startTime: '09:30', hours: '', ticket: '', note: 'è‡ªç”±é¸æ“‡ JR æˆ– å·´å£«', transportType: 'transit', travelTime: '1hr 15m', timetableId: 'sendai_jr_rapid', timetableLabel: 'JR æ™‚åˆ»', timetableId2: 'sendai_bus_express', timetableLabel2: 'å·´å£«æ™‚åˆ»' },
                { id: 303, date: '2026-02-05', name: 'Richmond Hotel (å¯„è¡Œæ)', category: 'ä½å®¿', startTime: '11:00', hours: '', ticket: '', note: 'å…ˆè‡³é£¯åº—å¯„æ”¾è¡Œæ', transportType: 'walk', travelTime: '8åˆ†' },
                { id: 304, date: '2026-02-05', name: 'å–„æ²»éƒç‰›èˆŒ (Zanjiro)', category: 'ç¾é£Ÿ', startTime: '11:30', hours: '', ticket: '', note: 'ä»™å°åç‰©ï¼ç«™å‰æœ¬åº—', transportType: 'walk', travelTime: '5åˆ†' },
                { id: 305, date: '2026-02-05', name: 'ä»™å°è»Šç«™å¤§çˆ†è²·', category: 'è³¼ç‰©', startTime: '13:00', hours: 'S-PAL / Parco', ticket: '', note: 'ä¼´æ‰‹ç¦®ã€æœé£¾ã€é›œè²¨', transportType: 'walk', travelTime: '0åˆ†' },
                { id: 306, date: '2026-02-05', name: 'Clis Road å•†åº—è¡—', category: 'è³¼ç‰©', startTime: '16:00', hours: '', ticket: '', note: 'è—¥å¦åº—æ¿€æˆ°å€', transportType: 'walk', travelTime: '10åˆ†' },
                { id: 307, date: '2026-02-05', name: 'ç±³æ¾¤ç‰›ç‡’è‚‰ ä»”è™ (S-PALåº—)', category: 'ç¾é£Ÿ', startTime: '18:30', hours: '', ticket: 'å»ºè­°é ç´„', note: 'ä¸åƒé­šçš„å¥½é¸æ“‡ï¼šA5ä»™å°ç‰›ç‡’è‚‰', transportType: 'walk', travelTime: '5åˆ†' },
                { id: 308, date: '2026-02-05', name: 'å›é£¯åº—æ•´ç† & å¯„è¡Œæ', category: 'å…¶ä»–', startTime: '20:30', hours: '', ticket: '', note: 'é»‘è²“å®…æ€¥ä¾¿å¯„å¾€æ˜Ÿé‡å¥§å…¥ç€¨', transportType: 'walk', travelTime: '10åˆ†' },

                // Day 4: 2/6
                { id: 401, date: '2026-02-06', name: 'ä»™å°æ—©æ™¨ (æœå¸‚/è£œè²¨)', category: 'è³¼ç‰©', startTime: '09:00', hours: '', ticket: '', note: 'ä»™å°æœå¸‚æˆ–è»Šç«™å‘¨é‚Š', transportType: 'walk', travelTime: '' },
                { id: 402, date: '2026-02-06', name: 'ä»™å°åˆé¤ (å£½å¸é€š)', category: 'ç¾é£Ÿ', startTime: '11:30', hours: '', ticket: '', note: 'ä»™å°è»Šç«™ 3F', transportType: 'walk', travelTime: '0åˆ†' },
                { id: 403, date: '2026-02-06', name: 'ç§»å‹•ï¼šä»™å° - å±±å½¢', category: 'äº¤é€š', startTime: '12:50', hours: '12:50-14:12', ticket: '', note: 'JR ä»™å±±ç·šå¿«é€Ÿ (ä»™å°ç™¼)', transportType: 'transit', travelTime: '1hr 22m' },
                { id: 404, date: '2026-02-06', name: 'å±±å½¢è»Šç«™ä¼‘æ¯', category: 'å…¶ä»–', startTime: '14:12', hours: 'åœç•™ 30åˆ†', ticket: '', note: 'è³¼è²·è£œçµ¦å“ã€ä¼‘æ¯', transportType: 'walk', travelTime: '0åˆ†' },
                { id: 405, date: '2026-02-06', name: 'ç§»å‹•ï¼šå±±å½¢ - å¤§çŸ³ç”°', category: 'äº¤é€š', startTime: '14:44', hours: '14:44-15:15', ticket: '', note: 'Tsubasa 137 (å±±å½¢ç™¼)', transportType: 'transit', travelTime: '31åˆ†' },
                { id: 406, date: '2026-02-06', name: 'æ¥é§å·´å£«å¾€éŠ€å±±', category: 'äº¤é€š', startTime: '15:40', hours: '', ticket: 'é ç´„åˆ¶', note: 'å¾¡å®¿ ã‚„ãªã å±‹ æ¥é§è»Š', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 407, date: '2026-02-06', name: 'å¾¡å®¿ ã‚„ãªã å±‹', category: 'ä½å®¿', startTime: '16:20', hours: '', ticket: '', note: 'Check-in', transportType: 'walk', travelTime: '0åˆ†' },
                { id: 408, date: '2026-02-06', name: 'éŠ€å±±æº«æ³‰å¤œæ™¯', category: 'æ™¯é»', startTime: '17:00', hours: '', ticket: '', note: 'Blue Hour æœ€ä½³æ‹æ”æ™‚é–“', transportType: 'walk', travelTime: '0åˆ†' },
                
                // Day 5: 2/7 (Precise Times)
                { id: 501, date: '2026-02-07', name: 'éŠ€å±± - å¤§çŸ³ç”°', category: 'äº¤é€š', startTime: '08:25', hours: '08:25-09:01', ticket: '', note: 'æ¥é§è»Š', transportType: 'transit', travelTime: '40åˆ†' },
                { id: 502, date: '2026-02-07', name: 'Tsubasa 136 å¾€å±±å½¢', category: 'äº¤é€š', startTime: '09:31', hours: '09:31-10:04', ticket: 'å·²é ç´„', note: 'å¤§çŸ³ç”° - å±±å½¢ (å·²ç”¨å‘¨éŠåˆ¸é ç´„)', transportType: 'transit', travelTime: '30åˆ†' },
                { id: 503, date: '2026-02-07', name: 'å±±å½¢ - ä»™å°', category: 'äº¤é€š', startTime: '10:12', hours: '10:12-11:35', ticket: '', note: 'JR ä»™å±±ç·šå¿«é€Ÿ', transportType: 'transit', travelTime: '1.2hr' },
                { id: 504, date: '2026-02-07', name: 'ä»™å° - å…«æˆ¶', category: 'äº¤é€š', startTime: '11:55', hours: '11:55-13:04', ticket: 'å·²é ç´„', note: 'Hayabusa 15 (å·²ç”¨å‘¨éŠåˆ¸é ç´„)', transportType: 'transit', travelTime: '1hr' },
                { id: 505, date: '2026-02-07', name: 'å…«æˆ¶è»Šç«™æ¥é§', category: 'äº¤é€š', startTime: '13:50', hours: '', ticket: '', note: 'å¾€å¥§å…¥ç€¨', transportType: 'transit', travelTime: '1.5hr' },
                { id: 506, date: '2026-02-07', name: 'æ˜Ÿé‡å¥§å…¥ç€¨æºªæµé£¯åº—', category: 'ä½å®¿', startTime: '15:30', hours: '', ticket: '', note: 'Check-in', transportType: 'transit', travelTime: '0åˆ†' },
                { id: 507, date: '2026-02-07', name: 'é’æ£®è˜‹æœå»šæˆ¿', category: 'ç¾é£Ÿ', startTime: '19:20', hours: '', ticket: '', note: 'æ™šé¤ Buffet', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 508, date: '2026-02-07', name: 'å¤œè§€å†°ç€‘', category: 'æ™¯é»', startTime: '21:15', hours: '', ticket: '', note: 'é£¯åº—æ´»å‹•', transportType: 'transit', travelTime: 'å°ˆè»Š' },
                
                // Day 6: 2/8
                { id: 601, date: '2026-02-08', name: 'è˜‹æœå»šæˆ¿æ—©é¤', category: 'ç¾é£Ÿ', startTime: '08:30', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 602, date: '2026-02-08', name: 'å¥§å…¥ç€¨æºªæµ Bus Tour', category: 'æ™¯é»', startTime: '13:25', hours: '', ticket: '', note: '', transportType: 'transit', travelTime: '' },
                { id: 603, date: '2026-02-08', name: 'æ¥é§è‡³æ˜Ÿé‡é’æ£®å±‹', category: 'äº¤é€š', startTime: '15:30', hours: '', ticket: '', note: 'è·¨é£¯åº—æ¥é§', transportType: 'transit', travelTime: '1hr' },
                { id: 604, date: '2026-02-08', name: 'Noresore æ™šé¤', category: 'ç¾é£Ÿ', startTime: '18:15', hours: '', ticket: '', note: 'é’æ£®å±‹è‡ªåŠ©é¤', transportType: 'walk', travelTime: 'é¤¨å…§' },
                // Day 7: 2/9
                { id: 701, date: '2026-02-09', name: 'Noresore æ—©é¤', category: 'ç¾é£Ÿ', startTime: '08:15', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 702, date: '2026-02-09', name: 'é’æ£®å±‹è¨­æ–½é«”é©—', category: 'æ™¯é»', startTime: '10:00', hours: '', ticket: '', note: 'æ³¡æ¹¯ã€æš–çˆé¦¬è»Š', transportType: 'walk', travelTime: '' },
                { id: 703, date: '2026-02-09', name: 'Noresore æ™šé¤', category: 'ç¾é£Ÿ', startTime: '18:15', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: '' },
                // Day 8: 2/10
                { id: 801, date: '2026-02-10', name: 'Noresore æ—©é¤', category: 'ç¾é£Ÿ', startTime: '07:15', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: 'é¤¨å…§' },
                { id: 802, date: '2026-02-10', name: 'æ¥é§è‡³ä¸‰æ²¢é§…', category: 'äº¤é€š', startTime: '09:00', hours: '', ticket: '', note: '', transportType: 'transit', travelTime: '20åˆ†' },
                { id: 803, date: '2026-02-10', name: 'ä¸‰æ²¢ - é’æ£®', category: 'äº¤é€š', startTime: '09:20', hours: '09:20-10:34', ticket: '', note: 'é’ä¹‹æ£®éµé“', transportType: 'transit', travelTime: '1.2hr', timetableId: 'misawa_aomori_train', timetableLabel: 'éµé“æ™‚åˆ»' },
                { id: 804, date: '2026-02-10', name: 'é’æ£® - é’æ£®æ©Ÿå ´', category: 'äº¤é€š', startTime: '12:30', hours: '12:30-13:05', ticket: '', note: 'JRå·´å£«æ±åŒ—', transportType: 'transit', travelTime: '35åˆ†' },
                { id: 805, date: '2026-02-10', name: 'BR121 é’æ£® - æ¡ƒåœ’', category: 'èˆªç­', startTime: '15:30', hours: '15:30-19:00', ticket: '', note: 'ç¬¬ä¸€èˆªå»ˆ', transportType: 'walk', travelTime: '' }
            ];

            const flights = [
                { type: 'å»ç¨‹', code: 'IT216', route: 'TPE - HND', time: '02/03 00:10 - 04:00', terminal: 'TPE T1 / HND T3' },
                { type: 'å›ç¨‹', code: 'BR121', route: 'AOJ - TPE', time: '02/10 15:30 - 19:00', terminal: 'AOJ / TPE T2' },
            ];

            const hotels = [
                { name: 'é«˜è¦‹å±‹ ç‘ ç’ƒä¿±æ¨‚åº¦å‡å€', phone: '023-610-9602', address: 'å±±å½¢ç¸£å±±å½¢å¸‚è—ç‹æº«æ³‰ä¸‰åº¦å·1118-7', date: '2/3-2/4' },
                { name: 'Richmond Hotel Premier', phone: '+81 22-716-2855', address: 'ä»™å°å¸‚é’è‘‰åŒºä¸­å¤®2-1-1', date: '2/5' },
                { name: 'å¾¡å®¿ ã‚„ãªã å±‹', phone: '0237-28-2030', address: 'å±±å½¢çœŒå°¾èŠ±æ²¢å¸‚å¤§å­—éŠ€å±±æ–°ç•‘416', date: '2/6' },
                { name: 'æ˜Ÿé‡å¥§å…¥ç€¨æºªæµé£¯åº—', phone: '+81 50-3134-8094', address: 'é’æ£®ç¸£åå’Œç”°å¸‚å¥¥ç€¬æ ƒä¹…ä¿231', date: '2/7' },
                { name: 'æ˜Ÿé‡é’æ£®å±‹', phone: '+81 50-3134-8094', address: 'é’æ£®ç¸£ä¸‰æ¾¤å¸‚å¤é–“æœ¨å±±56', date: '2/8-2/9' },
            ];

            // Setup Data with Version Check (Silent Update)
            const itineraryItems = ref([]);
            const shoppingList = ref(JSON.parse(localStorage.getItem('trip_shopping')) || []);
            const expenses = ref(JSON.parse(localStorage.getItem('trip_expenses')) || []);

            const storedVersion = localStorage.getItem('data_version');
            if (storedVersion !== DATA_VERSION) {
                console.log('Silent update to ' + DATA_VERSION);
                itineraryItems.value = defaultItinerary;
                localStorage.setItem('trip_itinerary', JSON.stringify(defaultItinerary));
                localStorage.setItem('data_version', DATA_VERSION);
            } else {
                itineraryItems.value = JSON.parse(localStorage.getItem('trip_itinerary')) || defaultItinerary;
            }

            const form = ref({});
            const shopForm = ref({ name: '', image: null });
            const expenseForm = ref({ category: 'é£²é£Ÿ', name: '', amount: '', date: '', payment: 'ç¾é‡‘' });

            watch(itineraryItems, (newVal) => localStorage.setItem('trip_itinerary', JSON.stringify(newVal)), { deep: true });
            watch(shoppingList, (newVal) => localStorage.setItem('trip_shopping', JSON.stringify(newVal)), { deep: true });
            watch(expenses, (newVal) => localStorage.setItem('trip_expenses', JSON.stringify(newVal)), { deep: true });

            const currentDayItems = computed(() => {
                const date = days[selectedDayIndex.value].date;
                return itineraryItems.value.filter(i => i.date === date).sort((a, b) => a.startTime.localeCompare(b.startTime));
            });

            const currentWeather = computed(() => {
                const map = [ { icon: 'fa-solid fa-cloud-showers-heavy', temp: -1, feel: -4 }, { icon: 'fa-regular fa-snowflake', temp: -5, feel: -9 }, { icon: 'fa-solid fa-cloud', temp: 2, feel: 0 }, { icon: 'fa-regular fa-snowflake', temp: -3, feel: -6 }, { icon: 'fa-regular fa-snowflake', temp: -4, feel: -8 }, { icon: 'fa-regular fa-snowflake', temp: -2, feel: -5 }, { icon: 'fa-regular fa-snowflake', temp: -2, feel: -5 }, { icon: 'fa-solid fa-sun', temp: 1, feel: -2 } ];
                return map[selectedDayIndex.value] || map[0];
            });

            const totalExpense = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));
            const sortedExpenses = computed(() => [...expenses.value].reverse());

            const tabClass = (tab) => currentTab.value === tab ? 'bg-white/90 text-deep-blue border-2 border-white' : 'bg-white/40 text-white border border-white/30';
            const getCategoryColor = (cat) => ({ 'æ™¯é»': 'bg-green-400', 'ä½å®¿': 'bg-purple-400', 'ç¾é£Ÿ': 'bg-orange-400', 'è³¼ç‰©': 'bg-pink-400', 'äº¤é€š': 'bg-blue-400', 'èˆªç­': 'bg-blue-600', 'å…¶ä»–': 'bg-gray-400' }[cat] || 'bg-gray-400');
            const transportIcon = (type) => ({ 'walk': 'fa-solid fa-person-walking', 'car': 'fa-solid fa-car', 'transit': 'fa-solid fa-train-subway' }[type] || 'fa-solid fa-shoe-prints');
            const getExpenseIcon = (cat) => `fa-solid ` + ({ 'é£²é£Ÿ': 'fa-utensils', 'äº¤é€š': 'fa-train', 'ä½å®¿': 'fa-bed', 'é–€ç¥¨': 'fa-ticket', 'è³¼ç‰©': 'fa-bag-shopping', 'å…¶ä»–': 'fa-circle-question' }[cat] || 'fa-circle');
            
            const openMap = (keyword) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(keyword)}`, '_blank');
            const openAddModal = () => { isEditing.value = false; form.value = { date: days[selectedDayIndex.value].date, category: 'æ™¯é»', name: '', startTime: '', hours: '', ticket: '', note: '', transportType: 'walk', travelTime: '15åˆ†', timetableId: '' }; showModal.value = true; };
            const editItem = (item) => { isEditing.value = true; editingId.value = item.id; form.value = JSON.parse(JSON.stringify(item)); showModal.value = true; };
            const saveItem = () => { if (isEditing.value) { const idx = itineraryItems.value.findIndex(i => i.id === editingId.value); if(idx !== -1) itineraryItems.value[idx] = { ...form.value, id: editingId.value }; } else { itineraryItems.value.push({ ...form.value, id: Date.now() }); } showModal.value = false; };
            const deleteItem = () => { if(confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) { itineraryItems.value = itineraryItems.value.filter(i => i.id !== editingId.value); showModal.value = false; } };
            const moveItem = (index, direction) => { const items = currentDayItems.value; const itemA = items[index]; const itemB = items[index + direction]; const tempTime = itemA.startTime; itemA.startTime = itemB.startTime; itemB.startTime = tempTime; };
            const closeModal = () => showModal.value = false;

            const handleImageUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (e) => shopForm.value.image = e.target.result; reader.readAsDataURL(file); } };
            const saveShopItem = () => { if(!shopForm.value.name) return; shoppingList.value.push({ ...shopForm.value }); shopForm.value = { name: '', image: null }; showShopModal.value = false; };
            const removeShoppingItem = (idx) => confirm('åˆªé™¤ï¼Ÿ') && shoppingList.value.splice(idx, 1);
            
            const saveExpense = () => { if(!expenseForm.value.amount) return; expenses.value.push({ ...expenseForm.value, date: expenseForm.value.date || new Date().toISOString().split('T')[0] }); showExpenseModal.value = false; expenseForm.value = { category: 'é£²é£Ÿ', name: '', amount: '', date: '', payment: 'ç¾é‡‘' }; };
            const removeExpense = (idx) => confirm('åˆªé™¤ï¼Ÿ') && expenses.value.splice(idx, 1);

            const openBusModal = (timetableId) => { 
                if (busTimetables[timetableId]) { 
                    currentBusSchedule.value = busTimetables[timetableId].schedule; 
                    currentBusRoute.value = busTimetables[timetableId].route;
                    showBusModal.value = true; 
                } 
            };

            onMounted(() => expenseForm.value.date = new Date().toISOString().split('T')[0]);

            return {
                currentTab, days, selectedDayIndex, currentWeather,
                currentDayItems, flights, hotels, shoppingList, expenses, totalExpense, sortedExpenses,
                rate, calcJpy, showModal, isEditing, form, showShopModal, shopForm, showExpenseModal, expenseForm,
                showBusModal, currentBusSchedule, currentBusRoute, locationGlossary, insuranceInfo,
                tabClass, getCategoryColor, transportIcon, getExpenseIcon,
                openMap, openAddModal, editItem, saveItem, deleteItem, closeModal, moveItem,
                handleImageUpload, saveShopItem, removeShoppingItem, saveExpense, removeExpense, openBusModal
            };
        }
    }).mount('#app');
</script>
</body>
</html>
